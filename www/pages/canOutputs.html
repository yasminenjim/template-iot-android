<ons-page id="canOutputs" class="page__background canOutputs-page">
  <ons-toolbar style="background-color: #094860;">
    <div class="left">
      <ons-back-button>Back</ons-back-button>
    </div>
    <div class="center" id="toolbar-title" style="color:rgb(255, 255, 255);text-align: center;">Can Outputs</div>
    <div class="right">
      <ons-toolbar-button onclick='gohome();'>
        <span style="color: rgb(255, 255, 255);">
          <i class="fa-solid fa-home"></i>
        </span>
      </ons-toolbar-button>
    </div>
  </ons-toolbar>
  <ons-carousel fullscreen swipeable auto-scroll overscrollable id="carousel" style="overflow-y: scroll;">
    <ons-carousel-item style="margin-top: 25px;" id="left-carousel">
      <p class="searchstyle">
        <ons-search-input id="searchInput" placeholder="Search" oninput="filterTable(this.value)"></ons-search-input>
      </p>
      <div style="margin-top: -64px; margin-left: 216px;">
        <button class="button-srch" onclick="filterTable(document.getElementById('searchInput').value)">Search</button>
      </div>
      <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Filter Options</h2>
            <label for="filterOption">Select Filter Option:</label>
            <select id="filterOption" name="filterOption">
              <option value="option1">Node ID</option>
              <option value="option2">SDO</option>
              <option value="option3">PDO</option>
            </select>
            <br><br>
            <button class="filterbuttonop" id="Apply" onclick="filteroptions()">Apply</button>
        </div>
      </div>
      
  <div class="buttoptcontainer"> 
    <button class="buttoptions" id="show-btn" onclick="showCan()">Show</button>
    <button class="buttoptions"id="stop-btn" onclick="stopCan()">Stop</button>
    <button class="buttoptions" id="filterBtn">Filter</button>
    <button class="buttoptions" onclick="clearTable()" id="clearingButton">Clear</button>
  </div> 
    <div class="table-container">
  <table id="can-table">
    <thead>
      <tr>
        <th class="thstyle">CanID</th>
        <th class="thstyle">NodeID</th>
        <th class="thstyle">Bytes</th>
        <th class="thstyle">Data</th>
      </tr>
    </thead>
    <tbody id="can-msgs">
    </tbody>
  </table>
    </div>
    <br>
    <br>
    <div id="pagination" style="margin-left: 237px;">
      <button class="paginationbutton" id="prev-page"><i class="fa-solid fa-chevron-left"></i></button>
      <span id="current-page" style="font-weight: bold;">Page 1</span>
      <button class="paginationbutton" id="next-page"><i class="fa-solid fa-chevron-right"></i></button>
      <br>
    </div>
    
</ons-carousel-item>


<ons-carousel-item style="background-color: rgb(241 241 241);">

  <ons-card class="m-2">
    <ons-row>
      <ons-col>
        <div class="text-center">
          <h4 mlang="overview">Select a type of message to send:</h4>
        </div>
      </ons-col>
    </ons-row>
    <onslist>
      <ons-list-item tappable>
        <label class="left">
          <ons-checkbox input-id="check-2" id="check-2"></ons-checkbox>
        </label>
        <label for="check-2" class="center">
          PDO
        </label>
      </ons-list-item>
       <ons-list-item tappable>
        <label class="left">
          <ons-checkbox input-id="check-1" id="check-1"></ons-checkbox>
        </label>
        <label for="check-1" class="center">
          SDO
        </label>
      </ons-list-item>
</onslist>
</ons-card>

<ons-card class="cardpdo" id="SDO">
  <h2>SDO</h2>
   <form id="sdoForm">
    <div style="font-family: monospace; padding: 16px;">
      <label for="nodeId">NODE-ID (1 byte)</label><br>
      <input type="text" id="nodeId" name="nodeId" size="4" maxlength="4" placeholder="0000"><br>
      <label for="cmd">CMD (1 byte)</label><br>
      <input type="text" id="cmdsdo" name="cmd" size="8" maxlength="8" placeholder="00000000"><br>
      <label for="sdo">SDO (2 bytes)</label><br>
      <input type="text" id="sdo1" name="sdo1" size="4" maxlength="4" placeholder="0000">
      <input type="text" id="sdo2" name="sdo2" size="4" maxlength="4" placeholder="0000"><br>
      <button class="buttonsendcan" type="submit">SEND</button>
    </div>
  </form>
</ons-card>

<ons-card class="cardpdo" id="PDO">
<h2>PDO</h2>
 <!--- 
  <div style="font-family: monospace; padding: 16px;">
    <span>COB-ID: </span><input type="text" size="3">
    <span>Node-ID: </span><input type="text" size="3">
    <br>
    <span>DLC: </span><input type="text" size="3">
    <span>Data 0: </span><input type="text" size="3">
   <button class="buttonsendcan">SEND</button> -->
   <form id="pdoForm">
    <div style="font-family: monospace; padding: 16px;">
      <label for="cobId">COB-ID (1 byte)</label><br>
      <input type="text" id="cobId" name="cobId" size="4" maxlength="4" placeholder="0000"><br>
      <label for="data">DATA (8 byte)</label><br>
      <input type="text" id="data1" name="data1" size="4" maxlength="4" placeholder="0000">
      <input type="text" id="data2" name="data2" size="4" maxlength="4" placeholder="0000"><br>
      <input type="text" id="data3" name="data3" size="4" maxlength="4" placeholder="0000">
      <input type="text" id="data4" name="data4" size="4" maxlength="4" placeholder="0000"><br>
      <button class="buttonsendcan" type="submit">SEND</button>
    </div>
  </form>
</ons-card>

</ons-carousel-item>


  </ons-carousel>
<script>
var rowsPerPage = 20;
var currentPage = 1;
//const clearButton = document.getElementById("clearingButton");
clearingButton.addEventListener("click", clearTable);
// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("filterBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}


function showCan() {
    fble.sendjson({can: "start"});
    console.log("showing can messages from showcan method");
}

function stopCan() {
    fble.sendjson({can: "stop"});
}
function clearTable() {
  // Clear the table
  var tableBody = document.getElementById("can-msgs");
  tableBody.innerHTML = "";

  // Reset the pagination
  var pagination = document.getElementById("pagination");
  var currentPageSpan = document.getElementById("current-page");
  var prevButton = document.getElementById("prev-page");
  var nextButton = document.getElementById("next-page");
  var totalPages = 1; // Update the total pages to 1

  currentPage = 1;

  currentPageSpan.innerHTML = "Page " + currentPage;
  //pagination.style.display = "none";
  
}




function filterTable(searchValue) {
  var tablevar = document.getElementById("can-table");
  var rows = tablevar.getElementsByTagName("tr");

  if (searchValue === "") { // reset table to original state
    for (var i = 0; i < rows.length; i++) {
      rows[i].style.display = "";
    }
    return;
  }

  for (var i = 0; i < rows.length; i++) {
    var cells = rows[i].getElementsByTagName("td");
    var visible = false;
    for (var j = 0; j < cells.length; j++) {
      if (cells[j].innerHTML.toUpperCase().indexOf(searchValue.toUpperCase()) > -1) {
        visible = true;
        break;
      }
    }
    if (visible) {
      rows[i].style.display = "";
    } else {
      rows[i].style.display = "none";
    }
  }
}

// Define a variable to keep track of the current page
var currentPage = 1;

// Define a function to show the rows for a given page
function showRowsForPage(page) {
  var startIdx = (page - 1) * 20;
  var endIdx = startIdx + 20;
  $("#can-msgs tr").hide().slice(startIdx, endIdx).show();
}

// Set up event listeners for the "Prev" and "Next" buttons
$("#prev-page").on("click", function() {
  if (currentPage > 1) {
    currentPage--;
    gotoPage(currentPage);
  }
});

$("#next-page").on("click", function() {
  if (currentPage < Math.ceil($("#can-msgs tr").length / 20)) {
    currentPage++;
    gotoPage(currentPage);
  }
});

// Define the gotoPage() function
function gotoPage(page) {
  $(".active-page").removeClass("active-page");
  $("#page-" + page).addClass("active-page");
  showRowsForPage(page);
  $("#current-page").text("Page " + page);
}

// Call the gotoPage() function with the initial page
gotoPage(1);

const table = document.getElementById('can-table');
const notificationPage = document.getElementById('notifications');


  const rowCount = table.rows.length;
  if (rowCount === 100) {
    var message = "There are more than 100 rows in the table!";
  var notifications = document.createElement("div");
  notifications.innerHTML = message;
  document.getElementById("notifications").appendChild(notifications);
  }


// Get the checkboxes and the cards
const sdoCheckbox = document.querySelector('#check-1');
const pdoCheckbox = document.querySelector('#check-2');

const sdoCard = document.querySelector('#SDO');
const pdoCard = document.querySelector('#PDO');
// Add a change event listener to the SDO checkbox
sdoCheckbox.addEventListener('change', function() {
  // If the checkbox is checked, show the SDO card and hide the PDO card
  if (sdoCheckbox.checked) {
    sdoCard.style.display = 'block';
  //  pdoCard.style.display = 'none';
    console.log("displaying sdo card from checkbox");

  } else { // If the checkbox is not checked, hide the SDO card
    sdoCard.style.display = 'none';
    console.log("hiding sdo card from checkbox");

  }
});

// Add a change event listener to the PDO checkbox
pdoCheckbox.addEventListener('change', function() {
  // If the checkbox is checked, show the PDO card and hide the SDO card
  if (pdoCheckbox.checked) {
    pdoCard.style.display = 'block';
    //sdoCard.style.display = 'none';
    console.log("displaying pdo card from checkbox");
  } else { // If the checkbox is not checked, hide the PDO card
    pdoCard.style.display = 'none';
    console.log("hiding the PDO card");

  }
});

const nodeFields = [
    document.getElementById("node-id-1"),
    document.getElementById("node-id-2"),
    document.getElementById("node-id-3"),
    document.getElementById("node-id-4")
  ];

  nodeFields.forEach((field) => {
    field.addEventListener("input", (event) => {
      const regex = /[^\d]/g;
      event.target.value = event.target.value.replace(regex, "");
    });
  });

  const cmdField = document.getElementById("cmd");
  cmdField.addEventListener("input", (event) => {
    const regex = /[^\d]/g;
    event.target.value = event.target.value.replace(regex, "");
  });

  const sdoFields = [
    document.getElementById("sdo-1"),
    document.getElementById("sdo-2")
  ];

  sdoFields.forEach((field) => {
    field.addEventListener("input", (event) => {
      const regex = /[^\d]/g;
      event.target.value = event.target.value.replace(regex, "");
    });
  });

</script>
 </ons-page>