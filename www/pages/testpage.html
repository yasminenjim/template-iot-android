<ons-page id="testpage"   class="page__background testpage-page" >
    <ons-toolbar style="background-color: #094860;" >
			<div class="left">
			  <ons-back-button style="color: aliceblue;" onclick='gohome();'>Back</ons-back-button>
			   </div>
			   <div class="center" style="color:rgb(255, 255, 255);text-align: center;margin-left: -49px;">Analog Channels</div>
</ons-toolbar><div id="myModalAO" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Info</h2>
      <p>this is some information</p>
    </div>
    </div>
	<button onclick="initializing()">test</button>

   <div id="cards-container">
    <!-- Card 0 -->
    <ons-card class="card-style-can" id="ao-card0">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-0">AI-0</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value0Input" data-card-id="0">
        <div class="range-values">
          <span class="range-value">0</span>
          <span class="range-value">4</span>
          <span class="range-value">8</span>
          <span class="range-value">12</span>
          <span class="range-value">16</span>
          <span class="range-value">20</span>
          <span class="range-value">24</span>
          <span class="range-value">28</span>
          <span class="range-value">32</span>
          <span class="range-value">36</span>
          <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div>
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span contenteditable="true" class="out-can" id="value0Display"></span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span contenteditable="true" class="out-can"></span>
            </div>
          </div>
        </div>
      </div>
    </ons-card>
    <!-- Card 1 -->
    <ons-card class="card-style-can" id="ao-card1">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-1">AI-1</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value1Input" data-card-id="1">
        <div class="range-values">
          <span class="range-value">0</span>
				  <span class="range-value">4</span>
				  <span class="range-value">8</span>
				  <span class="range-value">12</span>
				  <span class="range-value">16</span>
				  <span class="range-value">20</span>
				  <span class="range-value">24</span>
				  <span class="range-value">28</span>
				  <span class="range-value">32</span>
				  <span class="range-value">36</span>
				  <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div>
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span contenteditable="true" class="out-can" id="value1Display">8</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <input type="number" min="0" max="20" step="4" value="8" class="out-can" id="input-value1">
            </div>
          </div>
        </div>
      </div>
    </ons-card>
	<!-- Card 2 -->
    <ons-card class="card-style-can" id="ao-card2">
		<div class="modify-me">
		  <i class="fa-solid fa-circle-info" id="aboutchannels" style="color:#737373;"></i>
		</div>
		<div>
		  <h4 class="h4style" id="h4-2">AI-2</h4>
		</div>
		<div class="card-can-body">
		  <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value2Input" data-card-id="2">
		  <div class="range-values">
			<span class="range-value">0</span>
					<span class="range-value">4</span>
					<span class="range-value">8</span>
					<span class="range-value">12</span>
					<span class="range-value">16</span>
					<span class="range-value">20</span>
					<span class="range-value">24</span>
					<span class="range-value">28</span>
					<span class="range-value">32</span>
					<span class="range-value">36</span>
					<span class="range-value">40</span>
		  </div>
		  <div class="in-out">
			<div>
			  <p class="range-value-text">Output</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<span contenteditable="true" class="out-can" id="value2Display">8</span>
			  </div>
			</div>
			<div style="margin-top: -106px; margin-left: 340px;">
			  <p class="range-value-text">Input</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<input type="number" min="0" max="20" step="4" value="8" class="out-can" id="input-value2">
			  </div>
			</div>
		  </div>
		</div>
	  </ons-card>
	  <!-- Card 3 -->
	  <ons-card class="card-style-can" id="ao-card3">
		<div class="modify-me">
		  <i class="fa-solid fa-circle-info" id="aboutchannels" style="color:#737373;"></i>
		</div>
		<div>
		  <h4 class="h4style" id="h4-3">AI-3</h4>
		</div>
		<div class="card-can-body">
		  <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value3Input" data-card-id="3">
		  <div class="range-values">
			<span class="range-value">0</span>
					<span class="range-value">4</span>
					<span class="range-value">8</span>
					<span class="range-value">12</span>
					<span class="range-value">16</span>
					<span class="range-value">20</span>
					<span class="range-value">24</span>
					<span class="range-value">28</span>
					<span class="range-value">32</span>
					<span class="range-value">36</span>
					<span class="range-value">40</span>
		  </div>
		  <div class="in-out">
			<div>
			  <p class="range-value-text">Output</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<span contenteditable="true" class="out-can" id="value3Display">8</span>
			  </div>
			</div>
			<div style="margin-top: -106px; margin-left: 340px;">
			  <p class="range-value-text">Input</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<input type="number" min="0" max="20" step="4" value="8" class="out-can" id="input-value3">
			  </div>
			</div>
		  </div>
		</div>
	  </ons-card>
    <!-- Card 4 -->
    <ons-card class="card-style-can" id="ao-card4">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-4">AI-4</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value4Input" data-card-id="4">
        <div class="range-values">
          <span class="range-value">0</span>
				  <span class="range-value">4</span>
				  <span class="range-value">8</span>
				  <span class="range-value">12</span>
				  <span class="range-value">16</span>
				  <span class="range-value">20</span>
				  <span class="range-value">24</span>
				  <span class="range-value">28</span>
				  <span class="range-value">32</span>
				  <span class="range-value">36</span>
				  <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div>
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span contenteditable="true" class="out-can" id="value4Display">8</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <input type="number" min="0" max="20" step="4" value="8" class="out-can" id="input-value4">
            </div>
          </div>
        </div>
      </div>
    </ons-card>
	<!-- Card 5 -->
    <ons-card class="card-style-can" id="ao-card5">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-5">AI-5</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value5Input" data-card-id="5">
        <div class="range-values">
          <span class="range-value">0</span>
				  <span class="range-value">4</span>
				  <span class="range-value">8</span>
				  <span class="range-value">12</span>
				  <span class="range-value">16</span>
				  <span class="range-value">20</span>
				  <span class="range-value">24</span>
				  <span class="range-value">28</span>
				  <span class="range-value">32</span>
				  <span class="range-value">36</span>
				  <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div>
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span contenteditable="true" class="out-can" id="value5Display">8</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <input type="number" min="0" max="20" step="4" value="8" class="out-can" id="input-value5">
            </div>
          </div>
        </div>
      </div>
    </ons-card>
  </div>
  <script>
    //popup code
// Get the modal
var modal = document.getElementById("myModalAO");
// Get the button that opens the modal
var btn = document.getElementById("aboutchannels");
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];
// When the user clicks the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}
// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
/**********************************************************************************************/
function editHeading(id) {
  const heading = document.querySelector(`#${id}`);
  let newHeadingText = prompt('Enter new heading text:');
  newHeadingText = newHeadingText.toUpperCase();
  heading.textContent = newHeadingText;
}
// Add event listeners to range bars and input fields of each card
var cards = document.querySelectorAll('.card-style-can');
cards.forEach(function(card) {
  var cardId = card.id.replace('ao-card', '');
  var valueInput = card.querySelector('.range-bar');
  var inputField = card.querySelector('.out-can');
  var aoboxID = card.querySelector('.h4style');
  valueInput.addEventListener('input', sendaoOnChange);
  inputField.addEventListener('input', sendaoOnChange);
  valueInput.setAttribute('data-card-id', cardId);

  // Add event listener to update output value dynamically
  valueInput.addEventListener('input', function() {
    var cardId = this.getAttribute('data-card-id');
    var outputElement = document.getElementById('value' + cardId + 'Display');
    outputElement.innerText = this.value;
  });
});
function sendaoOnChange(event) {
  var cardId = event.target.getAttribute('data-card-id');
  var valueInput = document.getElementById('value' + cardId + 'Input');
  var inputField = document.getElementById('input-value' + cardId);
  var oavalue1;
  var oavalue2;

  //please take a look on the circuit (channels from AO box1 and AO box2 are linked together to input number 1,2,3,4)
  if (cardId === '0' || cardId === '1'|| cardId === '2'|| cardId === '3') {
    oavalue1 = {
      ao: {
        nr: 1,
        c: getChannelCount(cardId),
        mA: getMAValue(valueInput)
      }
    };
    oavalue2 = {
      ao: {
        nr: 2,
        c: getChannelCount(cardId),
        mA: getMAValue(valueInput)
      }
    };
    console.log(oavalue1);
    console.log(oavalue2);
  fble.sendjson(oavalue2);
    setTimeout(function() {
      fble.sendjson(oavalue1);
}, 2000);
      } 
  //this is for the third AO box
  else if (cardId === '4') {
    console.log("we are working on the card number 4");
    var channelCounts = getChannelCount(cardId);
    var cone = channelCounts[0];
    var ctwo = channelCounts[1];

    oavalue1 = {
      ao: {
        nr: 3,
        c: cone,
        mA: getMAValue(valueInput)
      }
    };
    oavalue2 = {
      ao: {
        nr: 3,
        c: ctwo,
        mA: getMAValue(valueInput)
      }
    };
    //console.log(oavalue1);
    console.log(oavalue2);
    console.log(oavalue1);
    fble.sendjson(oavalue2);
  console.log("sendding oavalue1 from card 4: ");
  setTimeout(function() {
      fble.sendjson(oavalue1);
}, 2000);
  }  

  else if (cardId === '5') {
    console.log("we are working on the card number 5");
    var channelCounts = getChannelCount(cardId);
    var cone = channelCounts[0];
    var ctwo = channelCounts[1];

    oavalue1 = {
      ao: {
        nr: 3,
        c: cone,
        mA: getMAValue(valueInput)
      }
    };
    oavalue2 = {
      ao: {
        nr: 3,
        c: ctwo,
        mA: getMAValue(valueInput)
      }
    };
    //console.log(oavalue1);
    console.log(oavalue2);
    console.log(oavalue1);
    fble.sendjson(oavalue2);
  console.log("sendding oavalue1 from card 5: ");
  setTimeout(function() {
      fble.sendjson(oavalue1);
}, 2000);
  }  
  console.log("Sending json object from notification page");}

function getChannelCount(cardId) {
  if (cardId === '0') {
    return 1;
  } else if (cardId === '1') {
    return 2;}
	else if (cardId === '2') {
    return 3;}
	else if (cardId === '3') {
    return 4;
  } else if(cardId === '4') {
    return [1,3];
  }
  else if(cardId === '5') {
    return [2,4];
  }
}

function getMAValue(valueInput) {
var mAdivided=(parseInt(valueInput.value))/2;
console.log("Divided");
console.log("sending the value: " + mAdivided + " mA to the AO box");
return mAdivided;
}

function initializing(){
  var oavalue;
	oavalue={ao:{nr:3,c:1,mA:0}};
	fble.sendjson(oavalue);
	console.log("sending the json object from the initializing function");
}
 </script>  
</ons-page>
