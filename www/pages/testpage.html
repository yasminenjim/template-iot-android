<ons-page id="testpage"   class="page__background testpage-page" >
    <ons-toolbar style="background-color: #094860;" >
      <div class="left">
        <ons-toolbar-button onclick='gohome();' >  
          <span style="color: rgb(255, 255, 255);">
            <i class="fa-solid fa-arrow-left" style="font-size: 20px;"></i>
           </span>
           </ons-toolbar-button>
        </div>
			   <div class="center" style="color:rgb(255, 255, 255);text-align: center;margin-left: -49px;">Analog Channels</div>
</ons-toolbar>
   <div id="cards-container">
    <!-- Card 0 -->
    <ons-card class="card-style-can" id="ao-card0">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels0" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-0">AI-0</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value0Input" data-card-id="0">
        <div class="range-values">
          <span class="range-value">0</span>
          <span class="range-value">4</span>
          <span class="range-value">8</span>
          <span class="range-value">12</span>
          <span class="range-value">16</span>
          <span class="range-value">20</span>
          <span class="range-value">24</span>
          <span class="range-value">28</span>
          <span class="range-value">32</span>
          <span class="range-value">36</span>
          <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div class="output-field">
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span class="out-can" id="value0Display">8 mA</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span class="out-can" fvar='{name:"a",idx:0}' id="input0Display">0 mA</span>
            </div>
          </div>
        </div>
      </div>
    </ons-card>
    <!-- Card 1 -->
    <ons-card class="card-style-can" id="ao-card1">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels1" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-1">AI-1</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value1Input" data-card-id="1">
        <div class="range-values">
          <span class="range-value">0</span>
				  <span class="range-value">4</span>
				  <span class="range-value">8</span>
				  <span class="range-value">12</span>
				  <span class="range-value">16</span>
				  <span class="range-value">20</span>
				  <span class="range-value">24</span>
				  <span class="range-value">28</span>
				  <span class="range-value">32</span>
				  <span class="range-value">36</span>
				  <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div class="output-field">
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span class="out-can" id="value1Display">8 mA</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" fvar='{name:"a",idx:1}' id="input1Display">0 mA</span>
            </div>
          </div>
        </div>
      </div>
    </ons-card>
	<!-- Card 2 -->
    <ons-card class="card-style-can" id="ao-card2">
		<div class="modify-me">
		  <i class="fa-solid fa-circle-info" id="aboutchannels2" style="color:#737373;"></i>
		</div>
		<div>
		  <h4 class="h4style" id="h4-2">AI-2</h4>
		</div>
		<div class="card-can-body">
		  <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value2Input" data-card-id="2">
		  <div class="range-values">
			<span class="range-value">0</span>
					<span class="range-value">4</span>
					<span class="range-value">8</span>
					<span class="range-value">12</span>
					<span class="range-value">16</span>
					<span class="range-value">20</span>
					<span class="range-value">24</span>
					<span class="range-value">28</span>
					<span class="range-value">32</span>
					<span class="range-value">36</span>
					<span class="range-value">40</span>
		  </div>
		  <div class="in-out">
			<div class="output-field">
			  <p class="range-value-text">Output</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" id="value2Display">8 mA</span>
			  </div>
			</div>
			<div style="margin-top: -106px; margin-left: 340px;">
			  <p class="range-value-text">Input</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" fvar='{name:"a",idx:2}' id="input2Display">0 mA</span>
			  </div>
			</div>
		  </div>
		</div>
	  </ons-card>
	  <!-- Card 3 -->
	  <ons-card class="card-style-can" id="ao-card3">
		<div class="modify-me">
			<i class="fa-solid fa-circle-info" id="aboutchannels3" style="color:#737373;"></i>
		  </div>
		<div>
		  <h4 class="h4style" id="h4-3">AI-3</h4>
		</div>
		<div class="card-can-body">
		  <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value3Input" data-card-id="3">
		  <div class="range-values">
			<span class="range-value">0</span>
					<span class="range-value">4</span>
					<span class="range-value">8</span>
					<span class="range-value">12</span>
					<span class="range-value">16</span>
					<span class="range-value">20</span>
					<span class="range-value">24</span>
					<span class="range-value">28</span>
					<span class="range-value">32</span>
					<span class="range-value">36</span>
					<span class="range-value">40</span>
		  </div>
		  <div class="in-out">
			<div class="output-field">
			  <p class="range-value-text">Output</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" id="value3Display">8 mA</span>
			  </div>
			</div>
			<div style="margin-top: -106px; margin-left: 340px;">
			  <p class="range-value-text">Input</p>
			  <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" fvar='{name:"a",idx:3}' id="input3Display">0 mA</span>
			  </div>
			</div>
		  </div>
		</div>
	  </ons-card>
    <!-- Card 4 -->
    <ons-card class="card-style-can" id="ao-card4">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels4" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-4">AI-4</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value4Input" data-card-id="4">
        <div class="range-values">
          <span class="range-value">0</span>
				  <span class="range-value">4</span>
				  <span class="range-value">8</span>
				  <span class="range-value">12</span>
				  <span class="range-value">16</span>
				  <span class="range-value">20</span>
				  <span class="range-value">24</span>
				  <span class="range-value">28</span>
				  <span class="range-value">32</span>
				  <span class="range-value">36</span>
				  <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div class="output-field">
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span class="out-can" id="value4Display">8 mA</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" fvar='{name:"a",idx:4}' id="input4Display">0 mA</span>
            </div>
          </div>
        </div>
      </div>
    </ons-card>
	<!-- Card 5 -->
    <ons-card class="card-style-can" id="ao-card5">
      <div class="modify-me">
        <i class="fa-solid fa-circle-info" id="aboutchannels5" style="color:#737373;"></i>
      </div>
      <div>
        <h4 class="h4style" id="h4-5">AI-5</h4>
      </div>
      <div class="card-can-body">
        <input type="range" min="0" max="40" step="4" value="8" class="range-bar" id="value5Input" data-card-id="5">
        <div class="range-values">
          <span class="range-value">0</span>
				  <span class="range-value">4</span>
				  <span class="range-value">8</span>
				  <span class="range-value">12</span>
				  <span class="range-value">16</span>
				  <span class="range-value">20</span>
				  <span class="range-value">24</span>
				  <span class="range-value">28</span>
				  <span class="range-value">32</span>
				  <span class="range-value">36</span>
				  <span class="range-value">40</span>
        </div>
        <div class="in-out">
          <div class="output-field">
            <p class="range-value-text">Output</p>
            <div style="margin-left: -79px;margin-top: -11px;">
              <span class="out-can" id="value5Display">8 mA</span>
            </div>
          </div>
          <div style="margin-top: -106px; margin-left: 340px;">
            <p class="range-value-text">Input</p>
            <div style="margin-left: -79px;margin-top: -11px;">
				<span class="out-can" fvar='{name:"a",idx:5}' id="input5Display">0 mA</span>
            </div>
          </div>
        </div>
      </div>
    </ons-card>
  </div>
   <!-- Modal popup -->
   <div id="myModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="modalTitle">Modal Title</h2>
      <p id="modalContent">Modal content</p>
    </div>
  </div>

  <div class="custom-popup" id="customPopup">
    <div class="custom-popup-content">
      <span class="customclose">&times;</span>
      <input type="number" id="currentNumberInput">
      <button id="submitBtnn">Submit</button>
    </div>
  </div>


  <script>
//popup code
// Get the modal
var modal = document.getElementById("myModal");

// Get the <span> element that closes the modal
var closeBtn = modal.querySelector(".close");

// Get the buttons that open the modal
var buttons = document.querySelectorAll(".fa-circle-info");
var manualinput = document.querySelectorAll(".custom-popup");



// Set event listeners for each button
buttons.forEach(function (button) {
  button.addEventListener("click", function () {
    // Get the corresponding card ID
    var cardId = this.parentElement.parentElement.id;

    // Get the title and content for the modal based on the card ID
    var title, content;

    if (cardId === "ao-card0") {
      title = "AI-0 Info";
      content = "LEFT PV/WHITE -> INNER/RED."
    } else if (cardId === "ao-card1") {
      title = "AI-1 Info";
      content = "RIGHT PV/ORANGE->OUTER/RED LONG.";
    }
	else if (cardId === "ao-card2") {
      title = "AI-2 Info";
      content = "RIGHT PV/ORANGE->INNER/RED";
    }
	else if (cardId === "ao-card3") {
      title = "AI-3 Info";
      content = "LEFT PV/RIGHT->OUTER RED LONG.";
    } else if (cardId === "ao-card4") {
      title = "AI-4 Info";
      content = "Tilt_sensor_left.";
    }
	else if (cardId === "ao-card5") {
      title = "AI-5 Info";
      content = "Tilt_sensor_right";
    }

    // Update the modal content with the title and content
    var modalTitle = modal.querySelector("#modalTitle");
    var modalContent = modal.querySelector("#modalContent");
    modalTitle.textContent = title;
    modalContent.textContent = content;

    // Display the modal
    modal.style.display = "block";
  });
});

// Close the modal when the <span> element is clicked
closeBtn.addEventListener("click", function () {
  modal.style.display = "none";
});
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
/**********************************************************************************************/
function editHeading(id) {
  const heading = document.querySelector(`#${id}`);
  let newHeadingText = prompt('Enter new heading text:');
  newHeadingText = newHeadingText.toUpperCase();
  heading.textContent = newHeadingText;
}

// Add event listeners to range bars and input fields of each card
var cards = document.querySelectorAll('.card-style-can');
cards.forEach(function(card) {
  var cardId = card.id.replace('ao-card', '');
  var valueInput = card.querySelector('.range-bar');
  var inputField = card.querySelector('.out-can');
  var aoboxID = card.querySelector('.h4style');
  valueInput.addEventListener('input', sendaoOnChange);
  inputField.addEventListener('input', sendaoOnChange);
  valueInput.setAttribute('data-card-id', cardId);

  // Add event listener to update output value dynamically
  valueInput.addEventListener('input', function() {
    var cardId = this.getAttribute('data-card-id');
    var outputElement = document.getElementById('value' + cardId + 'Display');
    var inElement = document.getElementById('input' + cardId + 'Display');
    outputElement.innerText = this.value+' mA';
    inElement.innerText = this.value+ ' mA';
    
  //	var value = event.target.value;
  //console.log('Input value:', value);
  console.log('Input value:', outputElement);
  });

});

function sendaoOnChange(event) {
  var cardId = event.target.getAttribute('data-card-id');
  var valueInput = document.getElementById('value' + cardId + 'Input');
  var inputField = document.getElementById('input-value' + cardId);
  var oavalue1;
  var oavalue2;

  //please take a look on the circuit (channels from AO box1 and AO box2 are linked together to input number 1,2,3,4)
  if (cardId === '0' || cardId === '1'|| cardId === '2'|| cardId === '3') {
    oavalue1 = {
      ao: {
        nr: 1,
        c: getChannelCount(cardId),
        mA: getMAValue(valueInput)
      }
    };
    oavalue2 = {
      ao: {
        nr: 2,
        c: getChannelCount(cardId),
        mA: getMAValue(valueInput)
      }
    };
    console.log(oavalue1);
    console.log(oavalue2);
    fble.sendjson(oavalue2);
    setTimeout(function() {
      fble.sendjson(oavalue1);
}, 2000);
      } 
  //this is for the third AO box
  else if (cardId === '4') {
    console.log("we are working on the card number 4");
    var channelCounts = getChannelCount(cardId);
    var cone = channelCounts[0];
    var ctwo = channelCounts[1];

    oavalue1 = {
      ao: {
        nr: 3,
        c: cone,
        mA: getMAValue(valueInput)
      }
    };
    oavalue2 = {
      ao: {
        nr: 3,
        c: ctwo,
        mA: getMAValue(valueInput)
      }
    };
    //console.log(oavalue1);
    console.log(oavalue2);
    console.log(oavalue1);
    fble.sendjson(oavalue2);
  console.log("sendding oavalue1 from card 4: ");
  setTimeout(function() {
      fble.sendjson(oavalue1);
}, 2000);
  }  

  else if (cardId === '5') {
    console.log("we are working on the card number 5");
    var channelCounts = getChannelCount(cardId);
    var cone = channelCounts[0];
    var ctwo = channelCounts[1];

    oavalue1 = {
      ao: {
        nr: 3,
        c: cone,
        mA: getMAValue(valueInput)
      }
    };
    oavalue2 = {
      ao: {
        nr: 3,
        c: ctwo,
        mA: getMAValue(valueInput)
      }
    };
    //console.log(oavalue1);
    console.log(oavalue2);
    console.log(oavalue1);
    fble.sendjson(oavalue2);
  console.log("sendding oavalue1 from card 5: ");
  setTimeout(function() {
      fble.sendjson(oavalue1);
}, 2000);
  }  
console.log("Sending json object from notification page");}

function getChannelCount(cardId) {
  if (cardId === '0') {
    return 1;
  } else if (cardId === '1') {
    return 2;}
	else if (cardId === '2') {
    return 3;}
	else if (cardId === '3') {
    return 4;
  } else if(cardId === '4') {
    return [1,3];
  }
  else if(cardId === '5') {
    return [2,4];
  }
}
function getMAValue(valueInput) {
var mAdivided=(parseInt(valueInput.value))/2;
console.log("Divided");
console.log("sending the value: " + mAdivided + " mA to the AO box");
return mAdivided;
}

/*****************************To send the output from typing*********************************************/
// Custom popup code
// Get the modal
var custommodal = document.getElementById("customPopup");

// Get the <span> element that closes the modal
var closeBtnn = custommodal.querySelector(".customclose");

// Get the buttons that open the modal
var outputfld = document.querySelectorAll(".output-field");

// Set event listeners for each button
outputfld.forEach(function (button) {
  button.addEventListener("click", function () {
    // Get the corresponding card ID
    var cardId = this.parentElement.parentElement.id;

    // Get the value from the input field
    var inputv = document.getElementById("currentNumberInput").value;


  if (cardId === "ao-card0" || cardId === 'ao-card1'|| cardId === 'ao-card2'|| cardId === 'ao-card3' ) {
  var oavalue1;
  var oavalue2;

  //please take a look on the circuit (channels from AO box1 and AO box2 are linked together to input number 1,2,3,4)
  
    oavalue1 = {
      ao: {
        nr: 1,
        c: getChannelCount(cardId),
        mA: inputv/2
      }
    };
    oavalue2 = {
      ao: {
        nr: 2,
        c: getChannelCount(cardId),
        mA: inputv/2
      }
    };
    console.log("oavalue2 from the input field"+ oavalue2);
    fble.sendjson(oavalue2);
    setTimeout(function() {
      fble.sendjson(oavalue1);
    console.log("oavalue2 from the input field"+ oavalue1);

}, 2000);
    
      
    }  else if (cardId === "ao-card4") {

      
    }
	else if (cardId === "ao-card5") {
      
    }

    // Update the modal content with the title and content
    outputfld.innerText = inputv + ' mA';

    // Display the modal
    custommodal.style.display = "block";
  });
});

// Close the modal when the <span> element is clicked
closeBtnn.addEventListener("click", function () {
  custommodal.style.display = "none";
});

// When the user clicks anywhere outside of the modal, close it
window.onclick = function (event) {
  if (event.target == custommodal) {
    custommodal.style.display = "none";
  }
};
 </script>  
</ons-page>
